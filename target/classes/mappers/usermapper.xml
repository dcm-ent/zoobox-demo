<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.dcm.zoobox.user.mapper.UserMapper" >
	<resultMap type="com.dcm.zoobox.user.model.User" id="UserMap">
		<id property="userId" column="user_id"/>
		<result property="password" column="password"/>
		<result property="username" column="username"/>
		<result property="email" column="email"/>
		<result property="nickname" column="nickname"/>
		<result property="birthdate" column="birthdate"/>
		<result property="phone" column="phone"/>
		<result property="regDate" column="reg_date"/>
		<result property="updateDate" column="update_date"/>
		<result property="gender" column="gender"/>
		<result property="bizId" column="biz_id"/>
		<result property="expertId" column="expert_id"/>
		<collection property="userRoleList" resultMap="userRoleMap"/>
		<collection property="userInfoList" resultMap="userInfoMap"/>
		<collection property="userSnsInfoList" resultMap="userSnsInfoMap" />
	</resultMap>
	<resultMap type="com.dcm.zoobox.user.model.UserInfo" id="userInfoMap"> 
		<result property="userInfoUd" column="user_info_id"/>
		<result property="userId" column="user_id"/>
		<result property="exp" column="exp"/>
		<result property="status" column="status"/>
		<result property="count" column="count"/>
		<result property="startDate" column="start_date"/>
	</resultMap>
	<resultMap type="com.dcm.zoobox.user.model.UserRole" id="userRoleMap"> 
		<result property="userId" column="user_id"/>
		<result property="authority" column="authority"/>
	</resultMap>
	<resultMap type="com.dcm.zoobox.user.model.UserSnsInfo" id="userSnsInfoMap"> 
		<result property="userSnsInfoId" column="sns_id"/>
		<result property="userId" column="user_id"/>
		<result property="snsEmail" column="email"/>
		<result property="type" column="type"/>
	</resultMap>
	
	<insert id="createUser" parameterType="UserMap">
		insert into user(email,password,birthdate,username,nickname,phone,gender)
		values (#{email},#{password},#{birthdate},#{username},#{nickname},#{phone},#{gender});
		
		<selectKey keyProperty="userId" order="AFTER" resultType="long">
					select last_insert_id() from dual;
		</selectKey>
	</insert>
	<insert id="createUserDetails" parameterType="Long">
		insert into user_role(user_id)
		values (#{userId});
		insert into user_info(user_id)
		values (#{userId});
	</insert>
	<select id="getUser" parameterType="Long" resultType="UserMap">
		select 
			user.user_id,username,password,email,nickname,birthdate,phone,reg_date,update_date,gender,biz_id,expert_id,user_info_id,exp,status,start_date,authority
		from 
			user left outer join user_info info on user.user_id = info.user_id left outer join user_role role on user.user_id = role.user_id
		where
			user.user_id = #{userId}
	</select>

</mapper>